<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Markdown Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <style>
        /* Your existing styles remain unchanged */
        :root {
            --primary-color: #0969da;
            --background-color: #ffffff;
            --text-color: #1f2328;
            --code-background: #f6f8fa;
            --border-color: #d0d7de;
            --copy-button-hover: #f3f4f6;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --primary-color: #539bf5;
                --background-color: #0d1117;
                --text-color: #e6edf3;
                --code-background: #161b22;
                --border-color: #30363d;
                --copy-button-hover: #21262d;
            }
        }

        /* Rest of your existing styles */
    </style>
</head>
<body>
    <div class="container">
        <div id="input-section">
            <input type="text" id="url-input" 
                   placeholder="Enter GitHub markdown URL or paste directly in browser address bar" 
                   value="">
            <button onclick="loadMarkdown()">Load Markdown</button>
        </div>
        <div id="error"></div>
        <div class="loading" id="loading">Loading markdown content...</div>
        <div id="content"></div>
    </div>

    <script>
        // Initialize mermaid (your existing mermaid config remains unchanged)
        mermaid.initialize({
            startOnLoad: true,
            theme: window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'default',
            securityLevel: 'loose'
        });

        // Your existing renderer setup remains unchanged

        function getMarkdownUrl() {
            // First check for url parameter (backward compatibility)
            const urlParams = new URLSearchParams(window.location.search);
            let mdUrl = urlParams.get('url');
            
            // If no url parameter, check the path
            if (!mdUrl) {
                // Get everything after the base path
                const basePath = '/markdown-browser-viewer/';
                const fullPath = window.location.pathname;
                
                if (fullPath.length > basePath.length) {
                    // Extract the URL part after the base path
                    mdUrl = fullPath.substring(basePath.length);
                    // Decode the URL
                    mdUrl = decodeURIComponent(mdUrl);
                    // If it doesn't start with http, assume it's a GitHub URL
                    if (!mdUrl.startsWith('http')) {
                        mdUrl = 'https://' + mdUrl;
                    }
                }
            }
            
            return mdUrl;
        }

        function convertToRawUrl(url) {
            // If it's already a raw URL, return it
            if (url.includes('raw.githubusercontent.com')) {
                return url;
            }
            
            // Ensure the URL starts with https://
            if (!url.startsWith('https://')) {
                url = 'https://' + url;
            }
            
            // Convert GitHub URL to raw URL
            url = url.replace('github.com', 'raw.githubusercontent.com')
                    .replace('/blob/', '/');
            
            return url;
        }

        // Rest of your existing functions (copyCode, loadMarkdown) remain unchanged

        // Modified window load event handler
        window.addEventListener('load', () => {
            const mdUrl = getMarkdownUrl();
            if (mdUrl) {
                document.getElementById('url-input').value = mdUrl;
                loadMarkdown();
            }
        });
    </script>
</body>
</html>
